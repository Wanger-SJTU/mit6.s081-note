# ch 8文件系统

文件系统的目的是用来组织存储数据，实现数据在不同用户、应用程序间共享，并提供数据的持久化存储支持（重启后数据仍然可用）。

xv6中的文件系统提供了与Unix类似的文件、目录以及文件路径（*refer to ch0*），通过磁盘的方式实现了数据持久化存储(*refer to ch3*)。文件系统通常需要面对以下的挑战：

- 文件系统需要磁盘上数据结构来表示目录树和文件，记录每个文件用于存储数据的块，以及磁盘上的空闲区域。
- 文件系统必须支持*崩溃恢复*，也就是说，如果系统崩溃了（比如掉电了），文件系统必须保证在重启后仍能正常工作。问题在于一次系统崩溃可能打断一连串的更新操作，从而使得磁盘上的数据结构变得不一致（如：有的块同时被标记为使用中和空闲）。
- 不同的进程可能同时操作文件系统，要保证这种并行不会破坏文件系统的正常工作。
- 访问磁盘比访问内存要慢几个数量级，所以文件系统必须要维护一个内存内的 cache 用于缓存常被访问的块。

本章的剩余部分将介绍文件系统是如何工作的。